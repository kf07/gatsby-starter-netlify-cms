---
templateKey: blog-post
title: 非同期処理 Promiseの使い方
date: 2018-11-03T07:51:23.120Z
description: javascript 非同期処理 Promiseの使い方
tags:
  - javascript
image: /img/javascript.jpg
---
## 非同期処理とは

例えば以下のコードを実行してみます

```javascript:

const func1 = () => {
  let msg = '#1';

  //#2
  setTimeout(() => {
    msg = `${msg}#2`;
  }, 10);

  //#3
  msg = `${msg}#3`;

  console.log(msg);
};

func1();
```

理想は 「#1#2#3」が出力されることですが  実際は「#1#3」が出力されます。  
これはsetTimeoutの#2の処理の終了を待たずに#3、console.logの処理が実行されてしまうからです。  
これを「非同期処理」といいます。


正しく動くようにpromiseを使ってみます。
```javascript:
const func2 = new Promise((resolve, reject) => {
  let msg = '#1';
  resolve(msg);
})
  .then(msg => {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        msg = `${msg}#2`;
        resolve(msg);
      }, 10);
    });
  })
  .then(msg => {
    msg = `${msg}#3`;
    console.log(msg);
  });

```
## Promiseの使い方
Promiseは非同期処理の状態を監視するオブジェクト  

構文
```javascript:
new Promise((resolve,reject)=> {
})
```
関数の引数のresolve,rejectは非同期処理の成功と失敗を通知する関数です  
resolve:成功  
reject:失敗

引数の値が空ならreject、それ以外ならresolveを返す関数をつくってみます  

```javascript:
const promise1 = value => {
  return new Promise((resolve, reject) => {
    if (value) {
      //引数の値があるならresolveで引数を返す
      resolve(value);
    } else {
      //引数が空ならrejectで'エラー'を返す
      reject('エラー');
    }
  });
};

```

Promiseの結果をthenメソッドでresolveまたはrejectを受け取ります。  

thenメソッドの構文
```javascript:
promise.then(success,failure)
```
promise:Promiseオブジェクト  
success:成功コールバック関数(resolve関数によって呼び出し)  
failure:失敗コールバック関数(reject関数によって呼び出し）

実行結果はpromise1の引数が空なら「エラー」、それ以外ならpromise1の引数になります。（以下の場合は「テスト」）
```javascript:
promise1('テスト').then(
  result => {
    //promiseの結果がresolveの場合
    console.log(result);
  },
  error => {
    //promiseの結果がrejectの場合
    console.log(error);
  }
);
```

